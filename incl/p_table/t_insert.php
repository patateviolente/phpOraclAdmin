<?phpif(!defined('IN_POA')) include('../../info.php');$LG = new Lang('t_insert', $lang);// Shared req$req_select = '	SELECT COLUMN_NAME N, DATA_TYPE T,		DATA_PRECISION PRE, DATA_SCALE SC, 		NULLABLE NUL, DATA_DEFAULT DEF, CHAR_LENGTH LEN	FROM USER_TAB_COLUMNS 	WHERE TABLE_NAME = \''.$_GET['table'].'\'';$ret = $AC->query($req_select);if($ret)	$attr = $AC->fetchAll();else{ 			echo display_code($LG->g(0).' : '.$AC->error(), $req_select, false);	$endfile = true;}////////////////////////////////////////// R E C E Pif(!isset($endfile) && (isset($_POST['insert']) || isset($_POST['editt']))){		// EDITION	if(isset($_POST['editt']) && isset($_POST['primarykey'])){		$toedit = explode(';', $_POST['editt']);				// Make req		$req = 'SELECT * FROM '.$_GET['table'].' WHERE ';				if(isset($_POST['primarykey'])){		// primary key : just one condition						foreach($toedit as $id){				$req = 'UPDATE '.$_GET['table'].' SET';								// Construction				for($u=0; $u<count($attr); $u++){					$r = str_replace("'", "''", $_POST[$attr[$u]['N'].$id]);					$n = isset($_POST['null-'.$attr[$u]['N'].$id]);					$req .= ' '.$attr[$u]['N'].' = '.(($n) ? 'null, ' : "'".$r."', "); 		// null ?				}				$req = substr($req, 0, -2);		// remove last ', '				$req .= ' WHERE '.$_POST['primarykey'].' = '.$id;								// exe				$ret = $AC->query($req);				echo display_code($LG->g(1).' '.((!$ret) ? $LG->g(2).' : '.$AC->error() : $LG->g(3)), $req, $ret);			}			if(!$ret)				echo '<input type="button" name="retour" onclick="history.go(-1)" value="'.$LG->g(4).'" />';								} else{									// no primary : all conditions + limit			echo display_error($LG->g(5));			$endfile = true;		}	}	if($endfile) break;		// NEW	if(isset($_POST['insert'])){		for($i=1; $i<=$_POST['insert']; $i++)		{			// Construction			$req[$i] = 'INSERT INTO '.$_GET['table'].' VALUES(';			for($u=0; $u<count($attr); $u++){				$r = $_POST[$attr[$u]['N'].$i];				$n = isset($_POST['null-'.$attr[$u]['N'].$i]);				$req[$i] .= ($n) ? 'null, ' : "'".$r."', "; 		// null ?			}			$req[$i] = substr($req[$i], 0, -2);		// remove last ', '			$req[$i] .= ')';			$ret = $AC->query($req[$i]);			echo display_code($LG->g(6).' '.((!$ret) ? $AC->error() : ''), $req[$i], $ret);		}	} 	// EDIT	else{			}}////////////////////////////////////////// D I S P L A Yelse if(!isset($endfile)){	////////////////////////////////////////	/* Display a table for one entry	 * @param id Field id	 * @param Narray String array with params   	 * @param val (facultative) data array for edition.	 */	function displayAttrSelect($id, $Narray, $val = null){		global $LG;		// FIELD				$tab = 1;		$count=0;		foreach($Narray as $row)		{			// TYPE			echo '		<tr '.(($count++%2 == 0) ? 'class="even"' : 'class="odd"').'>			<td>'.$row['N'].'</td>';						// null			echo '<td id="type'.$id.'">'.$row['T'].'</td>';			echo '<td id="oper'.$id.'">'.(($row['NUL'] == 'Y')					? '<input type="checkbox" name="null-'.$row['N'].$id.'" id="null-'.$row['N'].$id.'"'.						(($val != null && empty($val[$row['N']]) || $val == null) ? 'checked="checked"' : '') . ' />'					: '').'</td>';			// value			echo '				<td id="valeur'.$row['T'].'">					<input type="text" name="'.$row['N'].$id.'" tabindex="'.($id+$tab++).'" 						onfocus="clearIfDefault(this, \''.$row['DEF'].'\')"						onkeyup="checkAlwaysNull(getElementById(\'null-'.$row['N'].$id.'\'), this)"						maxlength="'.$row['LEN'].'" value="'.(($val == null) ? $row['DEF'] : $val[$row['N']]).'" />				</td>			</tr>';		}		if($val == null)			echo '<tr><th colspan="4"><input type="submit"  tabindex="'.($id+$tab++).'"  value="'.$LG->g(10).'" name="'.$id.'" /></th></tr>';	}	////////////////////////////////////////	// Get attribute array	echo '	<form method="post" id="forminsert" action="'.str_replace('t_display', 't_insert', rootURL()).'"		onsubmit="return true;">';				// Edition ?		$edition = false;		//if(isset($_GET['edit'])) $_POST['toedit'] = $_GET['edit'];		//if(isset($_GET['primarykey'])) $_POST['primarykey'] = $_GET['primarykey'];		if(isset($_POST['toedit']) && isset($_POST['primarykey'])){			$toedit = explode(';', $_POST['toedit']);						// Make req			$req = 'SELECT * FROM '.$_GET['table'].' WHERE ';			if(isset($_POST['primarykey'])){		// primary key : just one condition				foreach($toedit as $id)					$req .= $_POST['primarykey'].' = \''.addslashes($id).'\' OR ';				$req = substr($req, 0, -3);	// rm last 'OR '			} else{									// no primary : all conditions + limit				echo display_error($LG->g(11));				$endfile = true;			}			if($endfile) break;			// display & execute req			$ret = $AC->query($req);			echo display_code($LG->g(12).((!$ret) ? ' : '.$AC->error() : ''), $req, $ret);			if(!$ret){ 				$enfile = true;				break;			}			$dataedit = $AC->fetchAll();			$edition = true;			echo '<p><input type="hidden" name="editt" value="'.$_POST['toedit'].'" />				<input type="hidden" name="primarykey" value="'.$_POST['primarykey'].'" /></p>';		} else			echo '<p><input type="hidden" name="insert" value="1" /></p>';				// List & send		if($endfile) break;		$nforms = ($edition) ? count($toedit) : 1;		for($i=0; $i < $nforms; $i++){			echo '		<table cellspacing="2" cellpadding="0" class="tab_ins">			<tr>				<th>'.$LG->g(15).'</th>				<th>'.$LG->g(16).'</th>				<th>'.$LG->g(17).'</th>				<th>'.$LG->g(18).'</th>			</tr>';			if($edition)				displayAttrSelect($toedit[$i], $attr, $dataedit[$i]);			else				displayAttrSelect(1, $attr, null);			echo '		</table><p></p>';		}		if($edition)			echo '<input type="submit" name="valid" tabindex="1000000" value="'.$LG->g(20).'" />';		echo '	</form>';}echo '<div id="result_insert"></div>';?>